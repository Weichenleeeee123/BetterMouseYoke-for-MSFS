# BetterMouseYoke for MSFS

**其他语言版本: [English](README_EN.md), [中文](README.md).**


一个将鼠标转换为虚拟摇杆的工具，专为Microsoft Flight Simulator (MSFS) 设计。通过鼠标在屏幕上的移动来控制飞机的俯仰和滚转，提供更直观的飞行体验。

## 功能特点

### 🎮 核心功能
- **全屏幕操作范围** - 使用整个屏幕作为摇杆操作区域，提供最大的控制精度
- **自适应屏幕尺寸** - 自动检测并适配任何分辨率的屏幕
- **实时摇杆输出** - 通过vJoy驱动将鼠标移动转换为标准摇杆信号

### 🔄 智能状态管理
- **激活模式** - 鼠标控制摇杆，实时响应
- **锁定模式** - 摇杆保持在指定位置，鼠标可自由移动
- **中心死区** - 在屏幕中心附近锁定时自动回正摇杆

### 地面滑行模式 (新增)
- **按住鼠标左键** - 在“激活模式”下，按住鼠标左键可进入地面滑行模式。
- **方向舵控制** - 此时，鼠标的水平移动将专门用于控制方向舵（Z轴），方便在地面上滑行。
- **保持姿态** - 进入此模式时，飞机的俯仰和滚转姿态将被锁定在当前位置。
- **平滑约束** - 鼠标会被平滑地“吸附”在一条水平线上，以提供流畅的单轴控制体验。

### 🎯 视觉反馈
- **中心十字架** - 白色十字架标示屏幕中心（摇杆中性位置）
- **锁定十字架** - 黄色十字架显示当前锁定的摇杆位置
- **地面滑行轴** - 在地面滑行模式下，显示一条青色水平线，表示方向舵的控制范围
- **透明覆盖层** - 不干扰其他应用程序的使用

## 系统要求

### 必需软件
- **Python 3.7+**
- **vJoy驱动** - 虚拟摇杆驱动程序
- **Microsoft Flight Simulator** 或其他支持摇杆输入的飞行模拟器

### Python依赖包
```
PyQt5
pyautogui
keyboard
pyvjoy
```

## 安装步骤

### 1. 安装vJoy驱动
1. 下载并安装 [vJoy驱动](http://vjoystick.sourceforge.net/)
2. 运行 `vJoyConf.exe` 配置工具
3. 启用至少一个虚拟摇杆设备（建议使用设备#1）
4. 确保设备状态显示为"OK"

### 2. 安装Python依赖
```bash
pip install PyQt5 pyautogui keyboard pyvjoy
```

### 3. 运行程序
```bash
python main.py
```

## 使用方法

### 基本操作

#### 🔑 热键控制
- **Ctrl+F** - 激活/锁定模式切换
- **ESC** - 完全退出摇杆模式

#### 📱 操作流程
1. **启动程序** - 运行 `python main.py`
2. **按Ctrl+F激活** - 鼠标跳转到屏幕中心，进入激活模式
3. **移动鼠标** - 在屏幕上移动鼠标控制摇杆
4. **按住鼠标左键** - 进入地面滑行模式，鼠标被平滑约束在水平线上，水平移动控制方向舵
5. **松开鼠标左键** - 退出地面滑行模式，恢复摇杆控制
6. **按Ctrl+F锁定** - 锁定当前摇杆位置，鼠标恢复自由移动
7. **按Ctrl+F重新激活** - 鼠标跳回锁定位置，继续控制
8. **按ESC退出** - 完全退出摇杆模式，重置所有状态


### ⚙️ 自定义配置
编辑 `config.py` 文件可调整以下参数：

```python
# 死区参数
DEAD_ZONE_FACTOR = 0.002        # 常规死区大小
CENTER_DEAD_ZONE_FACTOR = 0.01  # 中心死区大小

# 视觉样式
CENTER_CROSS_SIZE = 20          # 中心十字架大小
LOCKED_CROSS_SIZE = 15          # 锁定十字架大小

# 滑行轴控制参数
RUDDER_AXIS_WIDTH = 400         # 滑行轴在屏幕上的显示宽度 (像素)
```

## 技术原理

### 坐标映射
- **屏幕中心** → 摇杆中性位置 (16384, 16384)
- **屏幕边缘** → 摇杆最大偏移 (0-32767)
- **比例映射** → 保持屏幕宽高比，避免控制变形

### 坐标映射
- **屏幕中心** → 摇杆中性位置 (16384, 16384)
- **屏幕边缘** → 摇杆最大偏移 (0-32767)
- **比例映射** → 保持屏幕宽高比，避免控制变形

### 状态管理
```
未激活 ──Ctrl+F──→ 激活模式 ──Ctrl+F──→ 锁定模式
   ↑                              │
   └──────────Ctrl+F──────────────────┘
   
任何状态 ──ESC──→ 完全退出
```

### 鼠标平滑吸附 (新增)
- **平滑算法** - 采用线性插值算法，使鼠标在垂直方向上平滑地趋近目标水平线。
- **可调强度** - 通过 `smoothing_factor` 参数调整吸附的强度，实现更自然的鼠标移动。

## 故障排除

### 常见问题

#### vJoy设备未找到
```
vJoy 初始化失败: 未能找到任何可用的vJoy设备
```
**解决方案：**
1. 确认已正确安装vJoy驱动
2. 运行vJoyConf.exe，启用至少一个设备
3. 重启计算机
4. 检查设备是否被其他程序占用

#### 程序无响应
**解决方案：**
1. 检查是否有杀毒软件阻止键盘钩子
2. 以管理员权限运行程序
3. 确认PyQt5正确安装

#### 摇杆控制不准确
**解决方案：**
1. 调整config.py中的死区参数
2. 检查屏幕分辨率是否正确检测
3. 确认MSFS中摇杆设置正确


## 许可证

本项目采用MIT许可证。详见LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目！

---

**享受您的飞行体验！** ✈️
